# Инструкция по взаимодействию с API микросервиса MinIO

upd. 27.03.25

Данная инструкция описывает, как работать с обновленным API микросервиса MinIO для загрузки, получения и удаления файлов. API использует универсальные методы, которые позволяют управлять файлами с помощью параметров: имени файла, расширения, бакета и самого файла.

---

## Основные эндпоинты API

### 1. Загрузка файла
- **Эндпоинт:** `POST /api/files/upload-file-by-params`
- **Описание:** Позволяет загрузить файл любого типа в указанный бакет.
- **Параметры запроса:**
    - `fileName` (строка) — имя файла (например, `profileId` или `profileId_fileId`).
    - `fileExtension` (строка) — расширение файла (например, `.pdf`, `.jpg`).
    - `fileBucket` (строка) — название бакета (см. список бакетов ниже).
    - `file` (MultipartFile) — сам файл.
- **Ответ:** Ссылка на загруженный файл (строка).
- **Пример:**
  POST /api/files/upload-file-by-params
  fileName=12345
  fileExtension=.pdf
  fileBucket=user-diploms
  file=<файл.pdf>

**Ответ:** `"https://minio.example.com/user-diploms/12345.pdf"`

### 2. Получение файла
- **Эндпоинт:** `GET /api/files/get-file-by-params`
- **Описание:** Позволяет получить файл либо в виде ссылки, либо в виде массива байтов.
- **Параметры запроса:**
- `fileName` (строка) — имя файла.
- `fileExtension` (строка) — расширение файла.
- `fileBucket` (строка) — бакет, где лежит файл.
- `link` (булево) — флаг: `true` — вернуть ссылку, `false` — вернуть байты.
- **Ответ:**
- Если `link=true`: строка (ссылка на файл).
- Если `link=false`: массив байтов (содержимое файла).
- **Пример:**
  GET /api/files/get-file-by-params?fileName=12345&fileExtension=.pdf&fileBucket=user-diploms&link=true

**Ответ:** `"https://minio.example.com/user-diploms/12345.pdf"`

### 3. Удаление файла
- **Эндпоинт:** `DELETE /api/files/delete-file-by-params`
- **Описание:** Удаляет файл из указанного бакета.
- **Параметры запроса:**
- `fileName` (строка) — имя файла.
- `fileExtension` (строка) — расширение файла.
- `fileBucket` (строка) — бакет, где лежит файл.
- **Ответ:** HTTP 200 OK (без тела ответа).
- **Пример:**
  DELETE /api/files/delete-file-by-params
  fileName=12345
  fileExtension=.pdf
  fileBucket=user-diploms


---

## Бакеты и формат хранения файлов

Файлы в MinIO хранятся в специальных папках (бакетах), каждая из которых предназначена для определенного типа данных. Название файла формируется по шаблону, в зависимости от типа документа.

### Список бакетов и их назначение
1. **`user-avatars`** — аватарки пользователей.
- Формат: `profileId.jpg`
- Пример: `12345.jpg`
2. **`user-diploms`** — основные дипломы пользователей.
- Формат: `profileId.pdf`
- Пример: `12345.pdf`
3. **`user-additional-diploms`** — дополнительные дипломы.
- Формат: `profileId_fileId.pdf`
- Пример: `12345_001.pdf`
4. **`user-qualification`** — документы о повышении квалификации.
- Формат: `profileId_fileId.pdf`
- Пример: `12345_002.pdf`
5. **`user-passports`** — паспорта пользователей.
- Формат: `profileId.pdf`
- Пример: `12345.pdf`
6. **`user-templates`** — шаблоны документов.
- Формат: `profileId_fileId.pdf`
- Пример: `12345_003.pdf`
7. **`user-certs`** — сертификаты пользователей.
- Формат: `profileId_fileId.pdf`
- Пример: `12345_004.pdf`
8. **`expertise-answers`** — файлы, связанные с ответами на экспертизу.
- Формат: зависит от контекста, чаще `profileId_questionId.jpg`.
- Пример: `12345_005.pdf`

### Поддерживаемые расширения
- `.pdf` — для документов (дипломы, доп. дипломы, паспорта, сертификаты, повышение квалификаций).
- `.jpg` — для изображений (аватарки, фото экспертиз).
- `.docx` — для шаблонов и результирующих экспертиз.

### Правила именования
- `profileId` — уникальный идентификатор пользователя (например, `12345`).
- `fileId` — дополнительный идентификатор файла для отличия нескольких документов одного типа (например, `001`, `002`).
- Для основных документов (диплом, паспорт, аватарка) используется только `profileId`.
- Для дополнительных документов добавляется `_fileId` из собственной таблицы БД.

