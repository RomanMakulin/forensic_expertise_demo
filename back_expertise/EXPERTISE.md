[Назад](README.md)
# Схема базы данных для экспертиз

Эта схема описывает структуру базы данных для управления экспертизами, включая вопросы, ответы, фотографии и связь с чек-листами. Каждый ответ на вопрос экспертизы имеет ровно один связанный чек-лист (отношение "один к одному").

## Таблицы

### 1. Expertise (Экспертизы)
Хранит основную информацию об экспертизах.

| Поле                | Тип         | Описание                              |
|---------------------|-------------|---------------------------------------|
| `id`                | UUID        | Первичный ключ, уникальный идентификатор экспертизы |
| `profile_id`        | UUID        | Внешний ключ, ссылка на профиль пользователя |
| `case_number`       | VARCHAR(255)| Номер дела                            |
| `name`              | VARCHAR(255)| Название экспертизы                   |
| `ruling_date`       | DATE        | Дата решения                          |
| `court_name`        | VARCHAR(255)| Название суда                         |
| `start_date`        | DATE        | Дата начала                           |
| `end_date`          | DATE        | Дата окончания                        |
| `sign_date`         | DATE        | Дата подписания                       |
| `presiding_judge`   | VARCHAR(255)| Имя председательствующего судьи       |
| `plaintiff`         | VARCHAR(255)| Истец                                 |
| `location`          | VARCHAR(255)| Местоположение                        |
| `volume_count`      | VARCHAR(255)| Количество томов                      |
| `participants`      | TEXT        | Участники экспертизы                  |
| `inspection_date_time` | TIMESTAMP   | Дата и время осмотра                  |

**Пример данных:**

| id                                   | profile_id                           | case_number | name            | ruling_date |
|--------------------------------------|--------------------------------------|-------------|-----------------|-------------|
| 550e8400-e29b-41d4-a716-446655440100 | 550e8400-e29b-41d4-a716-446655440200 | 123/2025    | Экспертиза №1 | 2025-03-01  |

---

### 2. ExpertiseJudge (Судьи экспертизы)
Хранит информацию о судьях, связанных с экспертизой.

| Поле          | Тип         | Описание                              |
|---------------|-------------|---------------------------------------|
| `id`          | UUID        | Первичный ключ, уникальный идентификатор судьи |
| `full_name`   | VARCHAR(255)| Полное имя судьи                      |
| `expertise_id`| UUID        | Внешний ключ, ссылка на `Expertise`   |

**Пример данных:**

| id                                   | full_name         | expertise_id                         |
|--------------------------------------|-------------------|--------------------------------------|
| 550e8400-e29b-41d4-a716-446655440110 | Иванов И.И.       | 550e8400-e29b-41d4-a716-446655440100 |

---

### 3. ExpertiseQuestion (Вопросы экспертизы)
Хранит вопросы, ответы и связь с чек-листами.

| Поле                | Тип         | Описание                              |
|---------------------|-------------|---------------------------------------|
| `id`                | UUID        | Первичный ключ, уникальный идентификатор вопроса |
| `question_text`     | TEXT        | Текст вопроса                         |
| `answer`            | TEXT        | Ответ на вопрос                       |
| `answer_conclusion` | TEXT        | Заключение по ответу                  |
| `expertise_id`      | UUID        | Внешний ключ, ссылка на `Expertise`   |
| `checklist_instance_id` | UUID    | Уникальный внешний ключ, ссылка на `ChecklistInstances` (один к одному) |

**Пример данных:**

| id                                   | question_text    | answer          | expertise_id                         | checklist_instance_id                |
|--------------------------------------|------------------|-----------------|--------------------------------------|--------------------------------------|
| 550e8400-e29b-41d4-a716-446655440120 | Какой-то вопрос? | Какой-то ответ. | 550e8400-e29b-41d4-a716-446655440100 | 550e8400-e29b-41d4-a716-446655440050 |

---

### 4. ExpertisePhoto (Фотографии экспертизы)
Хранит пути к файлам фотографий, связанных с вопросами.

| Поле         | Тип         | Описание                              |
|--------------|-------------|---------------------------------------|
| `id`         | UUID        | Первичный ключ, уникальный идентификатор фотографии |
| `file_path`  | VARCHAR(255)| Путь к файлу фотографии               |
| `question_id`| UUID        | Внешний ключ, ссылка на `ExpertiseQuestion` |

**Пример данных:**

| id                                   | file_path            | question_id                          |
|--------------------------------------|----------------------|--------------------------------------|
| 550e8400-e29b-41d4-a716-446655440130 | /photos/photo1.jpg   | 550e8400-e29b-41d4-a716-446655440120 |

---

## Описание работы

1. **Создание экспертизы:**
    - Заполняется таблица `Expertise` с общей информацией.
    - Добавляются судьи в `ExpertiseJudge`.

2. **Добавление вопросов:**
    - Для каждой экспертизы создаются вопросы в `ExpertiseQuestion`.
    - Пользователь вводит текст вопроса и ответ.

3. **Связь с чек-листами:**
    - После ответа на вопрос пользователь выбирает чек-лист, тип и подтип (см. `parameter.md`).
    - Создается запись в `ChecklistInstances`, и её `id` записывается в `ExpertiseQuestion.checklist_instance_id`.

4. **Прикрепление фотографий:**
    - Фотографии добавляются в `ExpertisePhoto` с привязкой к вопросу.

5. **Получение данных:**
    - Для отображения экспертизы с вопросами, ответами и чек-листами используется JOIN между `Expertise`, `ExpertiseQuestion`, и `ChecklistInstances`.